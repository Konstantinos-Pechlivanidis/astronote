#!/usr/bin/env node
/**
 * Generate FE mirror of the Shopify campaign status vocabulary.
 *
 * Source of truth: `apps/shopify-api/constants/campaign-status.js`
 * Output: `apps/astronote-web/src/lib/shopify/constants/campaign-status.ts`
 *
 * This avoids duplicating strings across FE Zod schemas, TS unions, and UI filters.
 */

import fs from 'node:fs';
import path from 'node:path';

const REPO_ROOT = process.cwd();
const BACKEND_SOURCE = path.join(
  REPO_ROOT,
  'apps/shopify-api/constants/campaign-status.js',
);
const FRONTEND_OUT = path.join(
  REPO_ROOT,
  'apps/astronote-web/src/lib/shopify/constants/campaign-status.ts',
);

function extractArrayLiteral(fileText, constName) {
  const re = new RegExp(
    `export\\s+const\\s+${constName}\\s*=\\s*Object\\.freeze\\(\\[([\\s\\S]*?)\\]\\)`,
    'm',
  );
  const m = fileText.match(re);
  if (!m) return null;
  const body = m[1];
  const values = Array.from(body.matchAll(/'([^']+)'/g)).map(mm => mm[1]);
  return values;
}

function ensureDir(p) {
  fs.mkdirSync(p, { recursive: true });
}

const src = fs.readFileSync(BACKEND_SOURCE, 'utf8');
const values = extractArrayLiteral(src, 'CAMPAIGN_STATUS_VALUES');
if (!values || values.length < 2) {
  throw new Error('Failed to extract CAMPAIGN_STATUS_VALUES from backend constant');
}

// Keep stable ordering but write as const tuple for Zod + TS unions.
const outText = `/* eslint-disable */
/**
 * AUTO-GENERATED FILE â€” do not edit by hand.
 * Generated by: scripts/generate-shopify-campaign-statuses.mjs
 *
 * Source of truth: apps/shopify-api/constants/campaign-status.js
 */

export const SHOPIFY_CAMPAIGN_STATUS_VALUES = [
${values.map(v => `  '${v}',`).join('\n')}
] as const;

export type ShopifyCampaignStatus = (typeof SHOPIFY_CAMPAIGN_STATUS_VALUES)[number];

export const SHOPIFY_CAMPAIGN_STATUS_SET: ReadonlySet<string> = new Set(
  SHOPIFY_CAMPAIGN_STATUS_VALUES as readonly string[],
);
`;

ensureDir(path.dirname(FRONTEND_OUT));
fs.writeFileSync(FRONTEND_OUT, outText, 'utf8');
process.stdout.write(`Wrote ${FRONTEND_OUT}\n`);


