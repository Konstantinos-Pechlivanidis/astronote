# Retail Dependency Audit (apps/retail-api)

## Package manager & lockfiles
- Package manager: npm (root `package-lock.json` is canonical).
- Removed duplicate lockfiles to avoid drift: `apps/retail-api/package-lock.json`, `apps/retail-api/apps/api/package-lock.json`.
- Root `package-lock.json` refreshed via `npm install` after dependency alignment.

## Prisma versions (before/after)
- Previous spec in `apps/retail-api/package.json`: `prisma` / `@prisma/client` were `^6.16.1` (inconsistent with the hoisted 6.17.1 that was actually running).
- Updated to lock both to `6.17.1` (known working version with `url/directUrl` schema).
- Verified installed versions: `prisma 6.17.1`, `@prisma/client 6.17.1` (via `node -p require('prisma/package.json').version` etc.).

## Files changed
- `apps/retail-api/package.json`: pin `prisma` and `@prisma/client` to `6.17.1` (match actual runtime).
- `package-lock.json`: regenerated by `npm install` to align with the above.
- Removed redundant lockfiles under `apps/retail-api/` and `apps/retail-api/apps/api/`.

## Scripts & health checks (retail)
- Prisma migrate deploy (with provided Neon URLs): `npx prisma migrate deploy` → no pending migrations.
- Prisma status: `npx prisma migrate status` → DB up to date.
- Prisma generate: `npm -w @astronote/retail-api run prisma:generate` → OK.
- Lint: `npm -w @astronote/retail-api run lint` → OK.
- Build: `npm -w @astronote/retail-api run build` → OK.

## Commands executed (summary)
1) `npm install` (root) after dependency updates.
2) `cd apps/retail-api && DIRECT_DATABASE_URL=... DATABASE_URL=... npx prisma migrate deploy`
3) `cd apps/retail-api && npx prisma migrate status`
4) `npm -w @astronote/retail-api run prisma:generate`
5) `npm -w @astronote/retail-api run lint`
6) `npm -w @astronote/retail-api run build`
7) Version check: `node -p "require('prisma/package.json').version"` / `require('@prisma/client/package.json').version`

## Verification steps (for others)
1) From repo root: `npm ci` (if lock changes again) then `npm -w @astronote/retail-api run prisma:generate`.
2) With correct env (DATABASE_URL + DIRECT_DATABASE_URL), run `npm -w @astronote/retail-api run prisma:migrate:deploy`.
3) Confirm `/api/health/readiness` and app start succeed without Prisma schema errors.
4) Ensure no additional lockfiles are reintroduced under `apps/retail-api/`.
