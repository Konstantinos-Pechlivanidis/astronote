# Astronote Shopify API - Environment Variables
# Copy this file to .env for local development

# ============================================
# CORE APPLICATION
# ============================================
NODE_ENV=development
PORT=3000
LOG_LEVEL=info
LOG_DIR=./logs

# ============================================
# DATABASE (Neon Postgres)
# ============================================
# DATABASE_URL: Neon pooled connection (use for application connections)
# Format: postgresql://user:password@ep-xxx-xxx.region.aws.neon.tech/dbname?sslmode=require
DATABASE_URL=postgresql://username:password@ep-xxx-xxx.region.aws.neon.tech/dbname?sslmode=require

# DIRECT_URL: Neon direct connection (use for migrations, bypasses pooler)
# Format: postgresql://user:password@ep-xxx-xxx.region.aws.neon.tech/dbname?sslmode=require
DIRECT_URL=postgresql://username:password@ep-xxx-xxx.region.aws.neon.tech/dbname?sslmode=require

# ============================================
# REDIS
# ============================================
# Use individual variables for Redis Cloud compatibility
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_USERNAME=default
REDIS_PASSWORD=your_redis_password
REDIS_TLS=false
# Alternative: Use REDIS_URL if individual vars not available
# REDIS_URL=redis://username:password@host:port/db

# ============================================
# SHOPIFY
# ============================================
SHOPIFY_API_KEY=your_shopify_api_key
SHOPIFY_API_SECRET=your_shopify_api_secret
SCOPES=read_customers,write_customers,read_orders,read_discounts,write_discounts,read_checkouts,read_price_rules,write_price_rules,read_products
SESSION_SECRET=your_session_secret_key

# Mitto SMS Configuration
MITTO_API_BASE=https://messaging.mittoapi.com
MITTO_API_KEY=your_mitto_api_key
MITTO_TRAFFIC_ACCOUNT_ID=your_traffic_account_id
MITTO_SENDER_NAME=Astronote
MITTO_SENDER_NUMBER=+1234567890  # Optional: Phone number (alternative to sender name)
MITTO_WEBHOOK_SECRET=your_webhook_secret

# ============================================
# PUBLIC URLs
# ============================================
# HOST: Public base URL of Shopify API (for OAuth callbacks and webhooks)
# For production: https://astronote-shopify.onrender.com
# For local development: http://localhost:3000
HOST=http://localhost:3000

# FRONTEND_URL: Main web frontend URL (canonical)
FRONTEND_URL=http://localhost:5173

# PUBLIC_BASE_URL: Public base URL for links (canonical)
PUBLIC_BASE_URL=http://localhost:3000

# ============================================
# CORS
# ============================================
# Comma-separated allowed origins (canonical: CORS_ALLOWLIST, fallback: ALLOWED_ORIGINS)
# For production: https://astronote.onrender.com,https://astronote-shopify.onrender.com
# For local development: http://localhost:5173,http://localhost:3000
CORS_ALLOWLIST=http://localhost:5173,http://localhost:3000,https://astronote.onrender.com
# Legacy fallback (also supported):
# ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# ============================================
# APPLICATION
# ============================================
APP_DEFAULT_CURRENCY=EUR

# ============================================
# JWT & SECURITY
# ============================================
# Generate with: openssl rand -base64 32
JWT_SECRET=your_jwt_secret_key_min_32_characters_recommended

# API Key (optional, for external API authentication)
API_KEY=your_api_key_here

# Admin Token (DEVELOPMENT ONLY - for testing/admin operations in dev mode)
# ADMIN_TOKEN=dev-admin-token-12345

# Monitoring & Logging
LOG_LEVEL=info
LOG_DIR=./logs  # Directory for log files (default: ./logs)
SENTRY_DSN=your_sentry_dsn

# Stripe Configuration
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# Stripe Price IDs - EUR
STRIPE_PRICE_ID_1000_EUR=prod_your_price_id_1000_eur
STRIPE_PRICE_ID_5000_EUR=prod_your_price_id_5000_eur
STRIPE_PRICE_ID_10000_EUR=prod_your_price_id_10000_eur
STRIPE_PRICE_ID_25000_EUR=prod_your_price_id_25000_eur

# Stripe Price IDs - USD
STRIPE_PRICE_ID_1000_USD=prod_your_price_id_1000_usd
STRIPE_PRICE_ID_5000_USD=prod_your_price_id_5000_usd
STRIPE_PRICE_ID_10000_USD=prod_your_price_id_10000_usd
STRIPE_PRICE_ID_25000_USD=prod_your_price_id_25000_usd

# Stripe Subscription Price IDs (Recurring prices - REQUIRED for subscriptions)
# These must be configured as RECURRING prices in Stripe.
#
# Simplified (Retail-parity) mode (preferred):
# - starter => monthly
# - pro     => yearly
# Required: EUR + USD for both plans.
STRIPE_PRICE_ID_SUB_STARTER_EUR=price_your_starter_monthly_eur
STRIPE_PRICE_ID_SUB_STARTER_USD=price_your_starter_monthly_usd
STRIPE_PRICE_ID_SUB_PRO_EUR=price_your_pro_yearly_eur
STRIPE_PRICE_ID_SUB_PRO_USD=price_your_pro_yearly_usd
#
# Optional legacy "matrix" mode (Billing v2) for installs that support BOTH monthly+yearly for both plans:
# STRIPE_PRICE_ID_SUB_STARTER_MONTH_EUR=price_...
# STRIPE_PRICE_ID_SUB_STARTER_MONTH_USD=price_...
# STRIPE_PRICE_ID_SUB_STARTER_YEAR_EUR=price_...
# STRIPE_PRICE_ID_SUB_STARTER_YEAR_USD=price_...
# STRIPE_PRICE_ID_SUB_PRO_MONTH_EUR=price_...
# STRIPE_PRICE_ID_SUB_PRO_MONTH_USD=price_...
# STRIPE_PRICE_ID_SUB_PRO_YEAR_EUR=price_...
# STRIPE_PRICE_ID_SUB_PRO_YEAR_USD=price_...

# Stripe Credit Top-up Price ID (Optional - one-time price per credit)
# If not configured, custom price_data will be used
STRIPE_PRICE_ID_CREDIT_TOPUP_EUR=price_your_topup_eur

# ============================================
# URL SHORTENER
# ============================================
# URL_SHORTENER_TYPE: 'custom' (for backend redirects), 'bitly', 'tinyurl', or 'none' (disabled)
# NOTE: For backend redirects (database-backed /r/:token), use 'custom' with URL_SHORTENER_BASE_URL pointing to backend
# The enum values are: 'custom', 'bitly', 'tinyurl', 'none'
# 'custom' with base URL = backend redirect implementation
URL_SHORTENER_TYPE=custom
# URL_SHORTENER_BASE_URL: Base URL for short links (backend URL for /r/:token redirects)
# For production: https://astronote-shopify.onrender.com
# For local development: http://localhost:3000
URL_SHORTENER_BASE_URL=http://localhost:3000
# REDIRECT_ALLOWED_HOSTS: Optional - Comma-separated list of allowed hostnames for redirects (supports wildcards like *.myshopify.com)
# REDIRECT_ALLOWED_HOSTS=https://example.com,*.myshopify.com
# BITLY_API_TOKEN: Optional - Bitly API token if using 'bitly' shortener
# BITLY_API_TOKEN=your_bitly_api_token
# TINYURL_API_KEY: Optional - TinyURL API key if using 'tinyurl' shortener
# TINYURL_API_KEY=your_tinyurl_api_key

# ============================================
# QUEUE & SCHEDULER
# ============================================
# START_WORKER: Enable/disable BullMQ workers in this process
# Default: true (workers enabled)
# Set to false or 0 to disable workers (use separate worker service in production)
# For production: Set START_WORKER=false on API service, START_WORKER=true on worker service
START_WORKER=true
RUN_SCHEDULER=true
SMS_BATCH_SIZE=5000

# ============================================
# EVENT POLLING
# ============================================
EVENT_POLLING_ENABLED=true
EVENT_POLLING_INTERVAL=5

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_TRAFFIC_ACCOUNT_MAX=100
RATE_LIMIT_TRAFFIC_ACCOUNT_WINDOW_MS=1000
RATE_LIMIT_TENANT_MAX=50
RATE_LIMIT_TENANT_WINDOW_MS=1000
RATE_LIMIT_GLOBAL_MAX=200
RATE_LIMIT_GLOBAL_WINDOW_MS=1000

# ============================================
# PRODUCTION VALUES
# ============================================
# For production, update these in Render dashboard:
# NODE_ENV=production
# HOST=https://astronote-shopify.onrender.com
# FRONTEND_URL=https://astronote.onrender.com
# PUBLIC_BASE_URL=https://astronote-shopify.onrender.com
# CORS_ALLOWLIST=https://astronote.onrender.com,https://astronote-shopify.onrender.com
# DATABASE_URL=postgresql://... (Neon pooled)
# DIRECT_URL=postgresql://... (Neon direct)
# REDIS_HOST=redis-xxx.xxx.xxx.xxx (Redis Cloud)

# ============================================
# NOTES
# ============================================
# - See docs/env/standard-keys.md for full key reference
# - See docs/env/backward-compat.md for fallback keys supported
# - CORS_ALLOWLIST is canonical, ALLOWED_ORIGINS is supported as fallback